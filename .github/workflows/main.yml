name: Build Plugin from Zip
on: [push]
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      # 名前を「sethome_src.zip」に固定して解凍する
      - name: Unzip source
        run: |
          if [ -f "sethome_src.zip" ]; then
            unzip -o sethome_src.zip -d extracted_content
          elif [ -f "sethome_src.ZIP" ]; then
            unzip -o sethome_src.ZIP -d extracted_content
          else
            echo "Error: sethome_src.zip が見つかりません。ファイル名を確認してください。"
            ls -R
            exit 1
          fi
          
          # pom.xmlがある場所を探してルートへ移動
          PROJECT_ROOT=$(find extracted_content -name "pom.xml" -exec dirname {} \; | head -n 1)
          cp -r $PROJECT_ROOT/* ./

      - name: Set up JDK 17
        uses: actions/setup-java@v4
        with:
          java-version: '17'
          distribution: 'temurin'

      - name: Build with Maven
        run: mvn clean package

      - name: Upload Artifact
        uses: actions/upload-artifact@v4
        with:
          name: Custom-SetHome-Jar
          path: target/*.jar
